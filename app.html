<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Agora / Réseau (prototype) — Charlott’ Street Club</title>
  <meta name="description" content="Charlott’ Street Club — Prototype 100% client-side (aucune collecte)."/>
  <meta property="og:title" content="Agora / Réseau (prototype) — Charlott’ Street Club"/>
  <meta property="og:type" content="website"/>
  <meta property="og:image" content="./assets/logo-hero.png"/>
  <link rel="stylesheet" href="./styles.css"/>
  <!-- Ton JS global si besoin -->
  <script defer src="./js/main.js"></script>
</head>
<body>

  <!-- Topbar -->
  <header class="topbar">
    <nav class="topbar-nav">
      <div class="brand">
        <img src="./assets/logo-hero.png" alt="Logo CSC"/>
        <span>Charlott’ Street Club</span>
      </div>
      <a class="nav" href="./index.html">Accueil</a>
      <a class="nav" href="./app.html">/app</a>
      <a class="nav" href="./segments.html">/segments</a>
      <a class="nav" href="./media-kit.html">/media-kit</a>
      <a class="nav" href="./partenaires.html">/partenaires</a>
      <a class="nav" href="./associations.html">/associations</a>
      <span style="flex:1"></span>
      <a class="nav is-cta" href="./app.html">Rejoindre l’Agora</a>
    </nav>
  </header>

  <!-- Profil local (sans <form>) -->
  <div class="csc-profile" id="csc-profile" style="padding:12px 16px;">
    <span class="csc-avatar" data-avatar></span>
    <input name="name" id="csc-profile-name" placeholder="Ton pseudo (local)" aria-label="Ton pseudo"/>
    <button type="button" data-profile-save>Enregistrer</button>
    <span>Bienvenue, <strong data-user-name>Anonyme</strong></span>
  </div>

  <!-- Contenu principal -->
  <main class="container">
    <h2>Agora — Mini-réseau (local)</h2>
    <p class="meta">Tout est stocké dans ton navigateur (localStorage). Pas de serveur, pas de collecte.</p>

    <!-- Composer -->
    <section class="card">
      <form id="composer" style="display:flex;gap:.6rem;align-items:flex-start">
        <textarea id="content" rows="3" style="flex:1;border-radius:12px;padding:10px" placeholder="Écris un message…"></textarea>
        <button class="button primary" type="submit">Publier</button>
      </form>
    </section>

    <!-- Feed -->
    <section id="feed" class="grid" aria-live="polite" style="margin-top:16px"></section>

    <!-- Export / Import (HORS du <script>) -->
    <hr/>
    <div class="csc-export" style="margin-top:12px;">
      <button class="button" data-export>Télécharger mes données (.json)</button>
      <input type="file" data-import-file accept="application/json" hidden/>
      <button class="button" data-import>Importer des données (.json)</button>
      <p class="meta">Démo — export local uniquement (aucune collecte serveur).</p>
    </div>
  </main>

  <!-- Mini-réseau (JS pur) -->
  <script>
  // ===== Mini réseau local (posts + likes) =====
  (function(){
    const KEY = 'csc_feed_v1';
    const $feed = document.getElementById('feed');
    const $composer = document.getElementById('composer');
    const $content = document.getElementById('content');

    function read(){
      try { return JSON.parse(localStorage.getItem(KEY) || '[]'); }
      catch { return []; }
    }
    function write(items){
      localStorage.setItem(KEY, JSON.stringify(items));
      render();
    }
    function render(){
      const items = read();
      if (!items.length){
        $feed.innerHTML = '<div class="card">Aucun post… commence par écrire ✍️</div>';
        return;
      }
      $feed.innerHTML = items.map((p,i)=>`
        <article class="card">
          <div class="small meta">${new Date(p.ts).toLocaleString('fr-FR')}</div>
          <p style="white-space:pre-wrap">${p.text}</p>
          <div style="display:flex;gap:.5rem">
            <button class="button ghost" onclick="like(${i})" aria-label="Aimer">❤️ ${p.likes||0}</button>
            <button class="button outline" onclick="del(${i})" aria-label="Supprimer">Supprimer</button>
          </div>
        </article>
      `).join('');
    }

    // Expose de petites fonctions globales pour les onclick
    window.like = function(i){
      const items = read();
      if (!items[i]) return;
      items[i].likes = (items[i].likes||0) + 1;
      write(items);
    };
    window.del = function(i){
      const items = read();
      if (!items[i]) return;
      items.splice(i,1);
      write(items);
    };

    // Envoi du formulaire
    $composer.addEventListener('submit', (e)=>{
      e.preventDefault();
      const txt = ($content.value || '').trim();
      if (!txt) return;
      const items = read();
      items.unshift({ text: txt, ts: Date.now(), likes: 0 });
      write(items);
      $content.value = '';
    });

    // Premier rendu
    render();
  })();
  </script>

  <!-- Scripts UI : bouton flottant + profil + export/import -->
  <script defer src="./js/cta.js"></script>
  <script defer src="./js/profile.js"></script>
  <script defer src="./js/export.js"></script>
</body>
</html>

